<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Groq AI Soal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* { box-sizing: border-box; margin:0; padding:0; font-family: Arial, sans-serif; }
body { background: #f5f5f5; color:#333; }
.container { max-width: 800px; margin: 20px auto; padding: 20px; background: #fff; border-radius: 10px; shadow: 0 0 10px rgba(0,0,0,0.1); }
h1 { text-align:center; margin-bottom:20px; font-size:1.8rem; }
form { display:flex; flex-direction:column; gap:15px; }
.input-group { display: flex; gap: 10px; }
input[type="number"], select, textarea { width: 100%; padding: 10px; border-radius:5px; border:1px solid #ccc; font-size:1rem; }
.btn { flex: 1; background:#eee; color:#333; padding:12px; border-radius:5px; cursor:pointer; text-align:center; border: 1px solid #ddd; }
.btn-green { background:#28a745; color:#fff; padding:15px; border:none; border-radius:5px; cursor:pointer; font-size:1.1rem; font-weight:bold; }
#fileName { font-size:0.9rem; color:#007bff; text-align:center; }
.actions { display:flex; gap:10px; margin-top:10px; }
.actions button { flex:1; font-size:1.1rem; padding:15px; border-radius:8px; background:#007bff; color:#fff; border:none; cursor:pointer; }
</style>
</head>
<body>
<div class="container">
  <h1>Otomatis Jawab Soal via Foto</h1>

  <form id="aiForm">
    <div class="input-group">
      <label class="btn">
        üì∑ Ambil Foto
        <input type="file" name="foto" id="foto" accept="image/*" capture="camera" hidden>
      </label>
      <label class="btn">
        üñºÔ∏è Pilih Media
        <input type="file" name="foto" id="media" accept="image/*" multiple hidden>
      </label>
    </div>
    <div id="fileName">Belum ada file terpilih</div>

    <select name="jenis" required>
      <option value="">Pilih Jenis Soal</option>
      <option value="Pilihan Ganda">Pilihan Ganda</option>
      <option value="Essay">Essay</option>
      <option value="Pilihan Ganda dan Essay">PG + Essay</option>
    </select>

    <input type="number" name="jumlah" placeholder="Jumlah Soal" required>
    <button type="submit" class="btn-green">üöÄ Proses ke AI</button>
  </form>

  <hr style="margin:20px 0;">
  <h3>Soal</h3>
  <textarea id="soal" rows="8" readonly placeholder="Hasil soal akan muncul di sini..."></textarea>
  <h3>Jawaban</h3>
  <textarea id="jawaban" rows="8" readonly placeholder="Hasil jawaban akan muncul di sini..."></textarea>

  <div class="actions">
    <button type="button" onclick="window.print()">üñ®Ô∏è Print</button>
    <button type="button" id="exportWordBtn">üìÑ Export Word</button>
  </div>
</div>

<script>
const fotoIn = document.getElementById("foto");
const mediaIn = document.getElementById("media");
const fileNameDisp = document.getElementById("fileName");

const updateLabel = (input) => {
  const count = input.files.length;
  if(count > 10) {
    alert("Maksimal 10 gambar!");
    input.value = "";
    return;
  }
  fileNameDisp.textContent = count > 0 ? `${count} file siap diproses` : "Belum ada file terpilih";
};

fotoIn.addEventListener("change", () => { mediaIn.value = ""; updateLabel(fotoIn); });
mediaIn.addEventListener("change", () => { fotoIn.value = ""; updateLabel(mediaIn); });

let currentHistoryId = null;

document.getElementById("aiForm").addEventListener("submit", async e => {
  e.preventDefault();
  const formData = new FormData(e.target);
  
  document.getElementById("soal").value = "Sedang merangkum gambar & menyusun soal... ‚è≥";
  document.getElementById("jawaban").value = "";

  try {
    const res = await fetch("/ai/process", { method:"POST", body: formData });
    const data = await res.json();

    if(data.success){
      document.getElementById("soal").value = data.soal;
      document.getElementById("jawaban").value = data.jawaban;
      currentHistoryId = data.historyId;
    } else {
      alert("Gagal: " + (data.error || "Terjadi kesalahan AI"));
    }
  } catch(err){
    alert("Error koneksi ke server");
  }
});

document.getElementById("exportWordBtn").addEventListener("click", async () => {
  if(!currentHistoryId) return alert("Proses AI dulu!");
  const res = await fetch("/export/" + currentHistoryId);
  const data = await res.json();
  if(data.wordFile){
    window.location.href = data.wordFile;
  }
});
</script>
</body>
</html>
