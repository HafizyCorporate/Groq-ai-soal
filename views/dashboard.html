<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard</title>
<link rel="stylesheet" href="/css/style.css">
</head>
<body>
<header>
<h1>Dashboard AI Soal</h1>
<nav>
<a href="/dashboard">Home</a>
<a href="/logout">Logout</a>
</nav>
</header>

<main>
<section id="uploadSection">
<h2>Ambil Foto / Pilih dari Media</h2>
<button id="cameraBtn">Ambil Foto</button>
<button id="mediaBtn">Ambil dari Media</button>
<input type="file" id="fileInput" multiple accept="image/*" style="display:none;">
<div id="preview" style="margin-top:10px;"></div>
</section>

<section id="generateSection" style="margin-top:20px;">
<button id="generateBtn">Generate Soal & Export Word</button>
</section>

<section id="status" style="margin-top:20px;color:green;"></section>
</main>

<script>
const cameraBtn = document.getElementById("cameraBtn");
const mediaBtn = document.getElementById("mediaBtn");
const fileInput = document.getElementById("fileInput");
const preview = document.getElementById("preview");
const status = document.getElementById("status");
let files = [];

cameraBtn.addEventListener("click", () => { fileInput.setAttribute("capture","environment"); fileInput.click(); });
mediaBtn.addEventListener("click", () => { fileInput.removeAttribute("capture"); fileInput.click(); });

fileInput.addEventListener("change", e => { files = Array.from(e.target.files); preview.innerHTML = files.map(f=>`<p>${f.name}</p>`).join(""); });

document.getElementById("generateBtn").addEventListener("click", async () => {
  if(files.length === 0){ alert("Pilih foto dulu!"); return; }

  const formData = new FormData();
  files.forEach(f => formData.append("photos", f));

  status.innerText = "Proses generate soal, mohon tunggu...";
  try {
    const res = await fetch("/ai/generate", { method:"POST", body: formData });
    const data = await res.json();
    if(data.filename){
      status.innerText = "Soal berhasil digenerate! Mendownload Word...";
      window.location.href = `/export/${data.filename}`;
    } else { status.innerText = "Gagal generate soal!"; }
  } catch(err){ console.error(err); status.innerText = "Terjadi kesalahan!"; }
});
</script>
</body>
</html>
